- name: Add worknodes in cluster
  hosts: master1
  become: yes
  become_method: sudo

  tasks:
    - name: Add nginx repo key
      apt_key:
        url: https://nginx.ru/keys/nginx_signing.key
        state: present

    - name:  Get nginx repositorie deb
      shell: |
        echo "deb http://nginx.org/packages/$(. /etc/os-release; echo "$ID") $(lsb_release -cs) stable"
      register: debString

    - name:  Get nginx repositorie deb-src
      shell: |
        echo "deb-src http://nginx.org/packages/$(. /etc/os-release; echo "$ID") $(lsb_release -cs) stable"
      register: debStringSrc

    - name: Add nginx repo in /etc/apt/sources.list
      lineinfile:
        path: /etc/apt/sources.list
        line: "{{debString.stdout}}"

    - name: Add nginx repo in /etc/apt/sources.list
      lineinfile:
        path: /etc/apt/sources.list
        line: "{{debStringSrc.stdout}}"
