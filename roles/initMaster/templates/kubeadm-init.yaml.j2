{% if criType == "containerd" %}
apiVersion: kubeadm.k8s.io/v1alpha3
kind: InitConfiguration
nodeRegistration:
  criSocket: /run/containerd/containerd.sock

{% endif %}
---
apiVersion: kubeadm.k8s.io/v1alpha3
kind: ClusterConfiguration
kubernetesVersion: "{{ kubeVersion }}"
apiServerCertSANs:
- {{ hostvars[groups['masters'][0]]['ansible_hostname'] }}
- {{ hostvars[groups['masters'][1]]['ansible_hostname'] }}
- {{ hostvars[groups['masters'][2]]['ansible_hostname'] }}
- {{ hostvars[groups['masters'][0]]['ansible_host'] }}
- {{ hostvars[groups['masters'][1]]['ansible_host'] }}
- {{ hostvars[groups['masters'][2]]['ansible_host'] }}
- {{virtIp}}
- 127.0.0.1
{% if vrrp == "false" %}
controlPlaneEndpoint: {{ansible_host}}
{% endif %}
{% if vrrp == "true" %}
controlPlaneEndpoint: {{virtIp}}
{% endif %}
etcd:
  external:
    endpoints:
    - http://{{ hostvars[groups['masters'][0]]['ansible_host'] }}:2379
    - http://{{ hostvars[groups['masters'][1]]['ansible_host'] }}:2379
    - http://{{ hostvars[groups['masters'][2]]['ansible_host'] }}:2379
networking:
  podSubnet: {{CIDR}}
apiServerExtraArgs:
  apiserver-count: "3"
