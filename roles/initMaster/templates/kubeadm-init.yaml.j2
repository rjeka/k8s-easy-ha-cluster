{% if criType == "containerd" %}
apiVersion: kubeadm.k8s.io/v1alpha3
kind: InitConfiguration
nodeRegistration:
  criSocket: /run/containerd/containerd.sock
{% endif %}
{% if criType != "containerd" %}
---
apiVersion: kubeadm.k8s.io/v1beta1
kind: InitConfiguration
localAPIEndpoint:
  advertiseAddress: "{{ansible_host}}"
{% endif %}
---
apiVersion: kubeadm.k8s.io/v1beta1
kind: ClusterConfiguration
kubernetesVersion: "v{{ kubeVersion }}"
apiServer:
  certSANs:
  - {{ hostvars[groups['masters'][0]]['ansible_host'] }}
  - {{ hostvars[groups['masters'][1]]['ansible_host'] }}
  - {{ hostvars[groups['masters'][2]]['ansible_host'] }}
{% if vrrp == "true" %}
  - {{virtIp}}
{% endif %}
{% if vrrp == "false" %}
controlPlaneEndpoint: {{ansible_host}}
{% endif %}
{% if vrrp == "true" %}
controlPlaneEndpoint: {{virtIp}}
{% endif %}
etcd:
  external:
    endpoints:
    - http://{{ hostvars[groups['masters'][0]]['ansible_host'] }}:2379
    - http://{{ hostvars[groups['masters'][1]]['ansible_host'] }}:2379
    - http://{{ hostvars[groups['masters'][2]]['ansible_host'] }}:2379
networking:
  podSubnet: {{CIDR}}
  serviceSubnet: "10.96.0.0/12"
  dnsDomain: "cluster.local"
