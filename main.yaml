- name: Installing shared packages for the masters and work nodes
  hosts: all
  become: yes
  become_method: sudo


  tasks:
    - include_role:
        name: "{{ item }}"
      with_items:
      - kubelet


- name: Setting Up kubernetes msters
  hosts: masters
  become: yes
  become_method: sudo

  vars:
    - etcdName1: "{{ hostvars[groups['masters'][0]]['ansible_hostname'] }}"
    - etcdName2: "{{ hostvars[groups['masters'][1]]['ansible_hostname'] }}"
    - etcdName3: "{{ hostvars[groups['masters'][2]]['ansible_hostname'] }}"


  tasks:
    - name: Installing keepalived
      apt:
        name: keepalived

    - include_role:
        name: "{{ item }}"
      with_items:
      - containerd
      - etcd
